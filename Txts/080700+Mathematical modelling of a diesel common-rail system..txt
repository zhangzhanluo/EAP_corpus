Mathematical modelling of a diesel common-rail system
In diesel common-rail systems, the exact knowledge of the injection pressure is important to accurately control the injected diesel mass and thus the combustion process. This paper focuses on the mathematical modelling of the hydraulic and mechanical components of a common-rail system in order to describe the dynamics of the diesel rail pressure. Based on this model, an average model is derived to reduce the model complexity and to allow for a fast calculation of the mass flow into the rail for different crank shaft revolution speeds and openings of the fuel metering unit. The main purpose of this average model is to serve as a basis for a model-based (non-linear) controller design. The stationary accuracy of the models is validated by means of measurement data.
Keywords: diesel engine; common-rail injection; control-oriented modelling; physics-based modelling; 37N10; 37N35; 93C10; 93C95
1. Introduction
Common-rail injection technology is typically used in modern diesel engines. The major advantage compared to prior injection systems, e.g. in-line injection pumps, is that the process of injection and high-pressure generation is decoupled. This enables injections with arbitrary timing and quantity, even so-called multiple injections, which can significantly increase the efficiency and reduce exhaust emissions of the engine [[ 1]].
Figure 1 depicts a schematic diagram of the considered common-rail injection system. The central component of the system is a rail volume filled with highly pressurized diesel, which delivers diesel to the injectors. By opening and closing the injectors, the desired amount of diesel can be injected into the combustion chambers of the engine. The high pressure in the rail is generated by a radial piston pump, which is actuated by one or more eccentrics at the camshaft of the engine. The amount of diesel flow into the radial piston pump can be controlled by an electromagnetically actuated variable displacement valve (fuel metering unit, FMU). The FMU is supplied by a constant pressure, which is generated by a gear pump and an overflow valve. Due to leakages in the FMU, it is necessary to install a zero delivery throttle, which enables zero volume flows of the radial piston pump. In many configurations, a pressure control valve (PCV) is installed in the rail to transport diesel from the rail to the tank and thus to actively reduce the rail pressure.
Accurately controlling the rail pressure is an important prerequisite to achieve the desired quantity of fuel injected. Mathematical models provide the basis for the analysis of the dynamical behaviour and the design of control strategies. Stationary characteristic maps are frequently used to describe the system behaviour. These models must be calibrated by measurements and do not account for the dynamical behaviour. These models are thus not directly applicable for the controller design. First-principle models are more suitable for this purpose.
Graph: Figure 1. Schematic diagram of a common-rail system.
The authors of [[ 2]] developed a model of a diesel injection system, where the focus was set on the injection process itself. The models developed in [[ 3]] concentrate on a detailed description of the rail and the injection process as well. In [[ 4]], models of common-rail systems are presented which were primarily intended for the control design. These models are characterized by a low dimension and are based on a number of simplifications, which neglect some important effects, e.g. of the dynamics of the radial piston pump. Moreover, [[ 2], [ 4]] do not consider an FMU such that the models are not suitable for the considered common-rail system. The authors of [[ 6]] include the FMU in their model but do not consider a physics-based model of the radial piston pump. A more detailed model is given in [[ 8]] where a hybrid model for the common-rail system is developed. Although an approach for the description of cavitation in the radial piston pump is presented, a measured curve is utilized to describe the flow rate of the radial piston pump as a function of the current of the FMU.
Therefore, the aim of this paper is to develop a mathematical model of the common-rail system which ( 1) allows for a fast and yet accurate simulation of the dynamical behaviour and ( 2) which can be easily parameterized by means of construction parameters of the system. Section 2 summarizes the mathematical equations of this model and gives some simulation results. A comparison with measurements shows that the model is capable of accurately reproducing the real system behaviour. Due to its complexity, this model is, however, not directly applicable to design a controller. Thus, a reduced model of the system is developed in Section 3, which is based on averaging the system variables over one cycle of the piston motion of the radial piston pump. Simulation results show that the reduced model still exhibits a high accuracy and captures the essential dynamical behaviour of the system.
2. Detailed model
In this section, a detailed mathematical model of the common-rail system is derived. This model is based on the following assumptions and simplifications:

The pressure at the high-pressure side of the FMU is kept almost constant by means of the overflow valve. Thus, models of the gear pump and the overflow valve are not required. Instead, a constant pressure is presumed.

The effect of zero diesel flow for closed FMU, which is achieved by the zero delivery throttle in the real system, is approximated by an idealized FMU without leakage flow.

In this paper, a common-rail system without PCV is considered. This is a common configuration in cost-sensitive applications. The control of the rail pressure is thus only achieved by means of the FMU.
The exact time evolution of the injected diesel flow into the cylinders of the internal combustion engine strongly depends on the actual load of the engine. The model presented in this paper is primary developed for the design of a controller for the rail pressure. As will be seen later, it is not possible to influence the fast pressure fluctuations in the rail caused by the injection process. Therefore, a simplified model will be given, which, however, captures the main effects of the injection process.
2.1. Isentropic fluid model
Diesel pressure in a common-rail system varies from lower than atmospheric pressure (e.g. in the cylinders of the radial piston pump) to very high pressures in the rail. At pressures lower than vapour pressure, the fluid starts to vaporize. Moreover, the compressibility of diesel considerably decreases for high pressures. As these effects cause significant changes in the fluid properties, a model that describes the fluid for both cavitation and high-pressure cases is strived for, see also [[ 9]].
The subsequent model is based on an isentropic fluid, where the mass density and the bulk modulus (both depending on the pressure p) meet the relation
( 1)
Graph
To characterize diesel depending on its pressure p, three cases are distinguished:

Diesel at pressures higher than the upper vapour pressure , , is liquid.

In the pressure range diesel starts to vaporize, i.e. there is some liquid and some vapour part.

At pressures lower than the lower vapour pressure , , all diesel mass is vaporized.

The next sections deal with these three cases in detail and provide equations for and .
2.1.1. Case 1: p ≥ p vap,u
When describing fluids at moderate pressures, a constant bulk modulus can be used, see, e.g. [[11]]. However, for diesel pressures in a common-rail system, which can increase beyond 2000 bar, an increasing bulk modulus is observed in measurements, see Figure 2.[ 1] The bulk modulus is described as
( 2)
Graph
with the bulk modulus at reference pressure and the gradient . With Equation ( 1), the corresponding mass density is given by
( 3)
Graph
where is the mass density at reference pressure .
Graph: Figure 2. Mass density and bulk modulus .
2.1.2. Case 2: p vap,1  < p < p vap,u
In this case, the fluid is considered to be partly liquid and partly vaporized. Given the overall mass m, let us consider that a mass fraction is vaporized, while the mass fraction is still liquid. It is assumed that all fluid is liquid at , i.e. , and all fluid is vaporized at , i.e. . In general, the vaporized fraction is a non-linear function of the pressure p. In this work, it is supposed that increases linearly with decreasing pressure, see, e.g. [[ 9], [11]],
( 4)
Graph
The bulk modulus and mass density of the liquid fraction are given by Equations ( 2) and ( 3)
(5a)
Graph
(5b)
Graph
such that the volume of the liquid fraction is given by
( 6)The behaviour of the vaporized diesel is described by an isentropic process of ideal gas with the isentropic exponent
( 7)
Graph
where is the vapour density and is the volume at . Hence, the volume filled with the vaporized diesel is given in the form
( 8)
Graph
The density of the liquid–vapour mixture in this case reads as
( 9)
Graph
The bulk modulus is derived using Equation ( 1)
(10)
Graph
2.1.3. Case 3: p ≤ p vap,1
For very low pressures below , the fluid is considered to be completely vaporized. This case is obtained by means of Equations ( 7) and ( 3) resulting in the following simplified equations for the mass density and the bulk modulus
(11a)
Graph
(11b)
Graph
Figure 3 shows the mass density and the bulk modulus for low pressures. Note that the logarithmic scaling of the -axis has been used to depict the rapid rise at . Moreover, the discontinuity of at is due to the linear approximation of in Equation ( 4). Using a continuously differentiable approximation would eliminate this discontinuity. However, since continuity of is not necessary in the following derivations, the linear approximation in Equation ( 4) is feasible.
Graph: Figure 3. Mass density and bulk modulus at low pressures p.
2.2. Fuel metering unit
The FMU is used to control the diesel flow into the radial piston pump. Figure 4 shows the hydraulic part of the FMU, given by an inlet orifice, the variable cross section and an outlet orifice connected in series. The turbulent flow through the orifices can be described by
(12a)
Graph
(12b)
Graph
(12c)
Graph
where , , are the discharge coefficients, are the corresponding opening areas, are the mass densities of the diesel and are the pressure drops over the orifices.
Graph: Figure 4. Hydraulic set-up of the FMU.
Balance of mass gives . It is further assumed that . This is reasonable due to the small changes in pressure. Then, the mass flow through the FMU reads as
(13a)
Graph
Graph: Figure 5. Shape of the variable cross section of the FMU.
(13b)
Graph
(13c)
Graph
and , with the gear pump pressure and the gallery pressure . The mass density is approximated by the density at the mean pressure according to Section 2.1 in the form
(14)
Graph
The variable area is given as a function of the position of the valve spool. Since the opening area exhibits a triangular shape, increases quadratically with , see Figure 5. The movement of the valve spool is controlled by a solenoid, generating the (positive) magnetic force . The restoring force is due to a preloaded spring with stiffness . The mechanical system of the FMU can be described by
(15a)
Graph
with the position , the velocity , the mass of the spool (including the mass of all moving parts of the solenoid), and the damping coefficient . The preload of the spring is chosen as the position which corresponds to the maximum mass flow. The position is limited within the mechanical stops . The contact with the end stops is modelled by a perfectly inelastic collision, dissipating the whole kinetic energy. At the end stops, the equations of motion read as
(16)
Graph
and outside these stops, the motion is governed by Equation (15).
The magnetic force is generated by a solenoid, where the force is a function of both the position and the current applied to the electromagnet of the FMU. The current is controlled by a subordinate current controller such that the setpoint of the current serves as the control input to the system. An analytic model of the overall dynamics of the solenoid, including the current controller, is not meaningful due to the resulting complexity. Instead, the dynamics of the current-controlled solenoid is approximated by a first-order lag element with the time constant in the form
(17)
Graph
Here, is the stationary characteristic of the magnetic force as a function of the position and the current setpoint of the current controller. Figure 6 depicts the measured characteristic .
Graph: Figure 6. Magnetic force as a function of the current setpoint and the position .
2.3. Gallery volume
The mass flow of the FMU, Equation (13), is delivered into the small gallery volume between FMU and radial piston pump. The diesel mass flow out of is the sum of all flows into the cylinders of the radial piston pump. Therefore, the pressure is given by the balance of mass
(18)
Graph
with the bulk modulus and the density of diesel in this volume according to Section 2.1, , . Moreover, is the mass flow through the inlet valve of the i-th cylinder.
2.4. Radial piston pump
The radial piston pump delivers diesel into the rail by a periodic motion of the pistons. Starting at the top dead centre (TDC), the cylinder volume is increased due to the downward motion of the piston and the diesel in the cylinder is expanded until the inlet (suction) valve, SV in Figure 1, opens. Then, diesel flows from the gallery volume into the cylinder until the inlet valve closes again, which is the case when the cylinder pressure is higher than the gallery pressure. With the upward motion, the diesel is compressed until the outlet (high pressure) valve, HV in Figure 1, into the rail opens and diesel flows into the rail.
The radial piston pump is driven by the combustion engine such that its shaft rotates with the angular velocity of the crank shaft. During one revolution of the shaft, the cylinders are moving times up and down due to the eccentricities of the shaft. Moreover, the cylinders are mounted with a relative angle to each other, see Figure 1, and the motion of the cylinders is sinusoidal. Thus, the volume of the i-th cylinder reads as
(19)
Graph
with the number of cylinders . The volumes and are the dead volume of a cylinder and its displaced volume, respectively. In this paper, a radial piston pump with cylinders, cylinder strokes per revolution and is used. The resulting volumes and of the cylinders are shown in Figure 7.
Graph: Figure 7. Cylinder volumes and during one revolution of the crank shaft.
Using the balance of mass, the pressure in the cylinders reads as
(20)
Graph
with the diesel mass flow through the inlet (suction) valve into the cylinder, through the outlet (high pressure) valve into the rail and the leakage mass flow .
The areas of the spring loaded inlet valves depend on the difference in pressure . If the pressure difference is lower than , then the valve is closed, i.e. . For pressures higher than , the valve is completely opened, i.e. , with the maximum area of the suction valve. For pressures between these two levels, the area is assumed to increase linearly with the pressure drop. This results in the mathematical model of the form
(21)
Graph
The mass flow through the inlet valve is then given by
2.5. Rail
The rail is used as storage for pressurized diesel. It is connected to the radial piston pump, which supplies the mass flow , and the injectors, which inject the mass flow into the combustion chambers of the engine. The diesel pressure in the (constant) rail volume is formulated as
(25)
Graph
with the bulk modulus and the density of diesel in the rail according to Section 2.1. The overall injector leakage mass flow is modelled in the form of a laminar flow into the tank (pressure ), i.e.
(26)
Graph
with the leakage coefficient .
As already mentioned at the beginning of this section, the injection process is rather complex and therefore an accurate description of the injector mass flows , , with the number of injectors (equal to the number of cylinders of the combustion engine), is beyond the scope of this paper. A simplified description is meaningful, since the exact time evolution of the injector mass flow is irrelevant for the design of a control strategy for the rail pressure. Instead, a model is proposed, which covers the following essential characteristics:
The periodic injection of diesel yields fluctuations in the rail pressure with the frequency . These variations in the rail pressure should be included approximately in the mathematical model.

Of course, the average mass flow of the injectors of one injection cycle must be accurately described by the model.
Based on these considerations, a sawtooth characteristic of the form
2.6. Simulation results
In this section, simulation results are shown to analyse the behaviour of the modelled system, and the stationary mass flow is compared with measurements to validate the model.
Figure 8 depicts simulation results of the cylinder pressures and the gallery pressure , as well as the mass flows and for a constant FMU position 0.85, a crank revolution speed and a constant rail pressure Taking a closer look at cylinder 1 first, the pressure decreases during the downward stroke of the piston until the cylinder pressure is lower than the gallery pressure and the inlet valve opens. Since the FMU is rather widely opened, the increasing cylinder volume can be completely filled by the diesel flowing through the inlet valve, i.e. . After some time, however, the cylinder volume increases faster than it can be filled with diesel such that the diesel in the cylinder starts to cavitate. Then, the cylinder pressure is almost constant and thus also the mass flow into the cylinder remains almost constant. The cylinder pressure begins to rise again when the cylinder is completely filled with fluid. If this happens before the bottom dead centre (BDC) (as it is the case in Figure 8), the cylinder is completely filled at the BDC and the mass flow of the radial piston pump is solely determined by the geometrical displacement and the angular velocity of the pump. Moreover, in this case, the two cylinders do not influence each other since the inlet valve of cylinder 1 closes before the inlet valve of cylinder 2 opens.
In contrast to this, the FMU opening is smaller () in the simulation scenario depicted in Figure 9. This brings along that the cavitation in the cylinder immediately starts after the inlet valve opens and the cylinder is not completely filled when passing the BDC. Thus, in this case, the mass flow of the radial piston pump is also influenced by the opening of the FMU. Time intervals do occur where the inlet valves of both cylinders are opened and thus both cylinders draw diesel from the gallery.
Measurements of the cylinder pressures and mass flows are not available for a validation of the model. Thus, the average mass flow of the radial piston pump for various FMU positions and crank shaft revolution speeds are used to validate the stationary accuracy of the model. The results in Figure 10 show a comparison of the measurement data (cross symbols) with simulation results (solid lines). It can be seen that for small openings of the FMU, the mass flow is basically determined by the FMU opening and is almost independent of the angular velocity of the crank shaft. For higher openings, the mass flow is, however, determined by the geometrical displacement of the pump. A comparison of the measurement data with simulation results of the model shows that the maximum errors are well below 10%, which is a very good result since the model has been parameterized by the nominal geometrical parameters of the system only.
inally, in Figure 11, the dynamics of the modelled system is discussed. Here, the current is switched from 0 to 1 at and back to at . Due to the preload of the spring, this implies that the FMU is entirely opened for at the beginning and the end of the simulation and closed in between. The average injected diesel mass flow is set to . Since the injected mass flow is lower than the mass flow delivered by the radial piston pump from the beginning until and after , the rail pressure is increasing. During , the FMU is closed and no diesel is delivered to the rail. Thus, the rail pressure decreases in this time interval. When the current in the solenoid is switched at , the magnetic force leads the valve spool to move and close the FMU, see the time evolution of . Note that the rail pressure is still increasing a short time after the FMU is closed. This is due to the fact that one cylinder is still filled with diesel which is delivered into the rail. The same effect occurs when the FMU is opening. The cylinders have to be filled and the diesel compressed, before diesel is delivered to the rail. This results in some kind of dead time in the system, which is a function of the angular velocity of the crank shaft, see also [[ 8]].
3. Average model
As the ripples in the rail pressure due to the piston strokes of the pump and the injection process cannot be affected by the FMU, only the average value of the rail pressure during one stroke is relevant for the control strategy.[ 2] Typically, control strategies for the rail pressure are based on a stationary (measured) characteristic map of the mass flow of the pump as a function of the FMU position and the rotational speed of the pump . This approach, however, has two basic drawbacks:

In the controller design, handling of characteristic maps might be difficult, since higher derivatives of these maps are frequently required, e.g. in a flatness-based controller. The numerical calculation of these derivatives might become cumbersome.

It is difficult to analyse the influence of parameter variations or different installation sizes by means of maps obtained from measurements.
Thus, an average model based on the detailed model of the previous section is strived for. In order to derive an average model, only a single cylinder of the pump is considered in the first step. The influence of the second piston is taken into account in a second step.
3.1. Single cylinder
Figures 12 and 13 show the pressure and the mass flows and of one cylinder for one piston stroke, a constant FMU position (approximately 50% opening in Figure 12 and approximately 30% in Figure 13), and a constant rail pressure. The piston stroke can be divided into the subsequent phases:
The high-pressure valve is closed at the TDC and the pressure in the cylinder is equal to the rail pressure at . During phase I, both valves are closed such that the diesel mass in the cylinder is constant and the pressure decreases as the volume increases.

The inlet valve is opened at when the cylinder pressure is equal to the gallery pressure . In this phase, the mass flow through the inlet valve is high enough to completely fill the increasing volume of the cylinder.

If the pressure in the cylinder further drops beyond the vapour pressure , the diesel starts to vaporize. However, below the lower vapour pressure , all diesel is vaporized and the cylinder pressure is basically constant. In order to simplify the treatment of cavitation, is set in the average model. This is reasonable, since is small and thus errors connected to this simplification are negligible.

In this phase, the volume of the cylinder can again be filled completely before the piston reaches its BDC. Note that this phase is not present in Figure 13, where the FMU is opened only approximately 30% of its maximum value. Figure 12 showing the results for a wider opened FMU of 50% of its maximum value contains such a phase.

When the pressure rises above at , the inlet valve is closed and the diesel is compressed until the pressure reaches at .

In this phase, the outlet valve is open and diesel is delivered into the rail.
It can be seen that the mass of diesel delivered into the rail during one cycle of the piston stroke is given by the difference of the maximum diesel mass in the cylinder before the inlet valve closes and the mass at , i.e. the time when the inlet valve opens, . This directly gives the average mass flow in the form
4. Conclusions
In this paper, a detailed mathematical model of a common-rail diesel system was derived. A special focus was laid on the accurate modelling of the radial piston pump in combination with the FMU, where it was shown that cavitation occurs in the cylinders of the pump. This effect is typically not taken into account analytically in mathematical models of the system but has a significant influence on the system's behaviour. Based on this detailed model, an average model of considerably reduced complexity was derived. The stationary accuracy of both models was proven by means of measurement results of a real common-rail system.
One major advantage of the proposed model is that it can be easily parameterized by means of the geometric parameters of the system, not requiring extensive measurements. Thus, it is also possible to simulate different designs of the system (e.g. different size and number of pistons) and to estimate their performance without relying on extensive measurements. The average model also features these benefits and is, due to the reduced complexity, very well suited for a (non-linear) controller design.
Current research is dealing with new model-based control strategies based on the average model, where already first promising results have been obtained. These control strategies are currently further investigated by our project partner Robert Bosch GmbH.
Acknowledgements
The authors highly appreciate the support provided by Robert Bosch GmbH, in particular Matthias Bitzer, Johannes Nitzsche, Carolina Passenberg, Daniel Seiler-Thull and Adrian Trachte.
Notes 
1 Quantities labelled with tilde refer to normalized quantities. Here, the mass density and the bulk modulus are normalized to their values and at ambient pressure . All other quantities are normalized to their respective maximum values .
2 Instead of controlling the average pressure, it is often desired to control the peak pressure over one cycle of the cylinder stroke. Since the average and the peak pressure are directly coupled, controlling the peak pressure is equivalent to controlling the average pressure. Thus, subsequently only this case is considered.
3 Note that the closing time of the inlet valve of the second cylinder can be directly obtained from the closing time of the inlet valve of the first cylinder by using the fact that the time behaviour of the second cylinder is equal to the time behaviour of the first shifted by .
